<div class="finalizar-container">
  <!-- Indicador de Etapas -->
  <app-step-indicator currentStep="finalizar"></app-step-indicator>

  <!-- Conte√∫do principal com layout de duas colunas -->
  <div class="finalizar-content">
    
    <!-- Coluna Esquerda -->
    <div class="left-column">
      
      <!-- Se√ß√£o: Seus Dados -->
      <div class="section-card" *ngIf="userData">
        <h2 class="section-title">SEUS DADOS</h2>
        <div class="user-info">
          <div class="info-item">
            <span class="label">Nome:</span>
            <span class="value">{{ userData.nome }}</span>
          </div>
          <div class="info-item">
            <span class="label">Telefone:</span>
            <span class="value">{{ userData.telefone }}</span>
          </div>
          <div class="info-item">
            <span class="label">E-mail:</span>
            <span class="value">{{ userData.email }}</span>
          </div>
          <div class="info-item" *ngIf="userData.mensagem">
            <span class="label">Mensagem:</span>
            <span class="value">{{ userData.mensagem }}</span>
          </div>
        </div>
      </div>

      <!-- Se√ß√£o: Links das Lojas (apenas para link_loja) -->
      <div class="section-card" *ngIf="paymentMethod === 'link_loja' && product && product.linkLojas && product.linkLojas.length > 0">
        <h2 class="section-title">LINK DAS LOJAS</h2>
        <div class="links-list">
          <div *ngFor="let link of product.linkLojas" class="link-item">
            <div class="link-info">
              <span class="store-name">{{ link.nomeLoja }}</span>
              <span class="link-url">{{ link.linkProduto }}</span>
            </div>
            <button class="copy-button" (click)="copyLink(link.linkProduto)" [class.copied]="linkCopied[link.linkProduto]">
              <span *ngIf="!linkCopied[link.linkProduto]">
                <span class="copy-icon">üìã</span>
                Copiar Link
              </span>
              <span *ngIf="linkCopied[link.linkProduto]">
                <span class="copy-icon">‚úÖ</span>
                Copiado!
              </span>
            </button>
          </div>
        </div>
        
        <!-- Confirma√ß√£o dentro do card -->
        <div class="confirmation-section">
          <div class="confirmation-checkbox">
            <input 
              type="checkbox" 
              id="confirmReservation" 
              [(ngModel)]="confirmReservation"
              class="checkbox-input"
            >
            <label for="confirmReservation" class="checkbox-label">
              Me comprometo a entregar o item reservado at√© 19/01 aos noivos
            </label>
          </div>
          
          <!-- Mensagem de erro -->
          <div *ngIf="cardErro" class="error-message">
            <span class="error-icon">‚ö†Ô∏è</span>
            <div class="error-content">
              <div class="error-text">
                <h4 *ngIf="produtoIndisponivel">Produto j√° foi reservado</h4>
                <h4 *ngIf="!produtoIndisponivel">Erro ao finalizar reserva</h4>
                <p *ngIf="produtoIndisponivel">Este produto j√° foi reservado por outro convidado. Escolha outro presente.</p>
                <p *ngIf="!produtoIndisponivel">Ocorreu um erro ao finalizar a reserva. Tente novamente.</p>
              </div>
            </div>
          </div>
          
          <button 
            class="btn btn-success finalize-button" 
            (click)="finalizeReservation()"
            [disabled]="!confirmReservation">
            Finalizar Reserva
          </button>
        </div>
      </div>

      <!-- Se√ß√£o: Contribui√ß√£o Direta (apenas para contribuicao_direta) -->
      <div class="section-card" *ngIf="paymentMethod === 'contribuicao_direta'">
        <h2 class="section-title">CONTRIBUI√á√ÉO DIRETA</h2>
        
        <!-- Loading section -->
        <div class="loading-section" *ngIf="isLoadingPayment">
          <div class="loading-spinner"></div>
          <p>Gerando link de pagamento...</p>
        </div>
        
        <!-- Payment section -->
        <div class="payment-section" *ngIf="!isLoadingPayment && urlPagamento">
          <div class="payment-info">
            <div class="payment-header">
              <span class="payment-icon">üí≥</span>
              <span class="payment-title">Link de Pagamento Seguro</span>
            </div>
            <p class="payment-description">
              Sua contribui√ß√£o ser√° processada de forma segura atrav√©s do nosso parceiro de pagamento.
            </p>
            <div class="security-badges">
              <span class="badge">üîí SSL</span>
              <span class="badge">üõ°Ô∏è Seguro</span>
              <span class="badge">‚úÖ Verificado</span>
            </div>
          </div>
          
          <!-- Mensagem de erro -->
          <div *ngIf="cardErro" class="error-message">
            <span class="error-icon">‚ö†Ô∏è</span>
            <div class="error-content">
              <div class="error-text">
                <h4 *ngIf="produtoIndisponivel">Produto j√° foi reservado</h4>
                <h4 *ngIf="!produtoIndisponivel">Erro ao gerar pagamento</h4>
                <p *ngIf="produtoIndisponivel">Este produto j√° foi reservado por outro convidado. Escolha outro presente.</p>
                <p *ngIf="!produtoIndisponivel">Ocorreu um problema ao gerar o link de pagamento. Tente novamente.</p>
                
                <!-- Bot√£o para voltar √† lista quando produto indispon√≠vel -->
                <button *ngIf="produtoIndisponivel" class="btn btn-primary" (click)="goToHome()" style="margin-top: 15px;">
                  <span>üéÅ</span> Ver outros presentes
                </button>
              </div>
            </div>
          </div>
          
          <!-- Bot√£o de pagamento -->
            <button 
            class="payment-button btn btn-primary w-100 payment-button-custom"
            (click)="finalizeReservation()"
            [disabled]="isLoadingPayment">
            <span class="btn-icon">üí≥</span>
            <span *ngIf="!isLoadingPayment">Ir para Pagamento</span>
            <span *ngIf="isLoadingPayment">Salvando...</span>
            <span class="btn-arrow">‚Üí</span>
            </button>
        </div>
      </div>

      <!-- Se√ß√£o: Pagamento Direto (apenas para pagar_noivos) -->
      <div class="section-card" *ngIf="paymentMethod === 'pagar_noivos'">
        <h2 class="section-title">PAGAMENTO DIRETO</h2>
        
        <!-- Loading do link de pagamento -->
        <div *ngIf="isLoadingPayment" class="loading-section">
          <div class="loading-spinner"></div>
          <p>Gerando link de pagamento...</p>
        </div>
        
        <!-- Link de pagamento gerado -->
        <div *ngIf="!isLoadingPayment && urlPagamento" class="payment-section">
          <div class="payment-info">
            <div class="payment-header">
              <span class="payment-icon">üí≥</span>
              <span class="payment-title">Link de Pagamento Seguro</span>
            </div>
            <p class="payment-description">
              Seu pagamento ser√° processado de forma segura atrav√©s do nosso parceiro de pagamento.
            </p>
            <div class="security-badges">
              <span class="badge">üîí SSL</span>
              <span class="badge">üõ°Ô∏è Seguro</span>
              <span class="badge">‚úÖ Verificado</span>
            </div>
          </div>
          
          <!-- Mensagem de erro -->
          <div *ngIf="cardErro" class="error-message">
            <span class="error-icon">‚ö†Ô∏è</span>
            <div class="error-text">
              <h4 *ngIf="produtoIndisponivel">Produto j√° foi reservado</h4>
              <h4 *ngIf="!produtoIndisponivel">Erro ao processar reserva</h4>
              <p *ngIf="produtoIndisponivel">Este produto j√° foi reservado por outro convidado. Escolha outro presente.</p>
              <p *ngIf="!produtoIndisponivel">Ocorreu um erro ao salvar sua reserva. Tente novamente.</p>
              
              <!-- Bot√£o para voltar √† lista quando produto indispon√≠vel -->
              <button *ngIf="produtoIndisponivel" class="btn btn-primary" (click)="goToHome()" style="margin-top: 15px;">
                <span>üéÅ</span> Ver outros presentes
              </button>
            </div>
          </div>
          
          <button 
            class="btn btn-primary payment-button" 
            (click)="finalizeReservation()"
            [disabled]="isLoadingPayment">
            <span class="btn-icon" *ngIf="!isLoadingPayment">üí≥</span>
            <span class="btn-spinner" *ngIf="isLoadingPayment">‚è≥</span>
            <span *ngIf="!isLoadingPayment">Ir para Pagamento</span>
            <span *ngIf="isLoadingPayment">Salvando...</span>
            <span class="btn-arrow" *ngIf="!isLoadingPayment">‚Üí</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Coluna Direita -->
    <div class="right-column">
      
      <!-- Se√ß√£o: Contribui√ß√£o Selecionada (apenas para contribuicao_direta) -->
      <div class="contribution-section" *ngIf="paymentMethod === 'contribuicao_direta'">
        <h2 class="section-title">Contribui√ß√£o selecionada</h2>
        
        <div class="contribution-content">
          <!-- √çcone da Contribui√ß√£o -->
          <div class="contribution-icon-container">
            <span class="contribution-icon">üíù</span>
          </div>
          
          <!-- Detalhes da Contribui√ß√£o -->
          <div class="contribution-details">
            <h3 class="contribution-name">Contribui√ß√£o para o Enxoval</h3>
            <p class="contribution-description">Sua contribui√ß√£o ajudar√° os noivos a montar seu novo lar</p>
            <p class="contribution-price">Valor: R$ {{ getContributionValue() | currency:'BRL':'symbol':'1.2-2' }}</p>
          </div>
        </div>
      </div>

      <!-- Se√ß√£o: Produto Selecionado -->
      <div class="product-section" *ngIf="product">
        <h2 class="section-title">Produto selecionado</h2>
        
        <div class="product-content">
          <!-- Foto do Produto -->
          <div class="product-image-container">
            <img [src]="product.imageUrl" [alt]="product.imageAlt" class="product-image">
          </div>
          
          <!-- Detalhes do Produto -->
          <div class="product-details">
            <h3 class="product-name">{{ product.titulo }}</h3>
            <p class="product-description">{{ product.descricao }}</p>
            <p class="product-price">Valor m√©dio: R$ {{ (product.valor || 0) / 100 | currency:'BRL':'symbol':'1.2-2' }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bot√µes de Navega√ß√£o -->
  <div class="navigation-buttons">
    <button class="btn btn-secondary" (click)="goBack()">
      Voltar
    </button>
    
    <button class="btn btn-primary" (click)="goToHome()">
      Home
    </button>
  </div>
</div>